generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Sex {
  M
  F
}

model Client {
  id String @id @db.VarChar(40)
  legalName String @db.VarChar(50)
  name String? @db.VarChar(25)
  sex Sex
  dateOfBirth DateTime @db.Date
  requiresStaff Boolean @default(false)
  house House? @relation(fields: [houseId], references: id)
  houseId String? @db.VarChar(45)
  events Event[]
}

enum EmployeePosition {
  ASSOCIATE
  MANAGER
  DIRECTOR
  ADMIN
}
model Employee {
  id String @id @db.VarChar(40)
  name String @db.VarChar(50)
  sex Sex
  email String @unique @db.VarChar(65)
  password String @db.VarChar(65)
  position EmployeePosition @default(ASSOCIATE)
  hireDate DateTime @db.Date
  primaryHouses   House[] @relation("PrimaryManager")
  secondaryHouses House[] @relation("SecondaryManager")

  medicalEventsPrinted        MedicalEvent[] @relation("RecordPrintedBy")
  medicalEventsTakenToHouse   MedicalEvent[] @relation("RecordTakenToHouseBy")
  medicalEventsCompleted      MedicalEvent[] @relation("AppointmentCompletedBy")
  medicalEventsFiled          MedicalEvent[] @relation("RecordFiledBy")
  refreshTokens RefreshToken[]
  sessionTokens  Session[]
}

enum EventType {
  WORK
  MEDICAL
  SOCIAL
  OTHER
}
model Event {
  id                  String        @id @db.VarChar(40)
  type                EventType
  description         String        @db.Text
  beginDate           DateTime      @db.Date
  endDate             DateTime      @db.Date
  beginTime           DateTime      @db.Time()
  endTime             DateTime      @db.Time()
  numberStaffRequired Int           @db.Integer
  clientId            String        @db.VarChar(40)
  client              Client        @relation(fields: [clientId], references: id)
  medical             MedicalEvent?
}

model MedicalEvent {
  id                             String    @id @db.VarChar(40)
  recordNumber                   String    @db.VarChar(10)
  recordPrintedDate              DateTime? @db.Date
  recordPrintedEmpId             String?   @db.VarChar(40)
  recordPrintedBy                Employee? @relation("RecordPrintedBy", fields: [recordPrintedEmpId], references: [id])

  recordTakenToHouseDate         DateTime? @db.Date
  recordTakenEmpId               String?   @db.VarChar(40)
  recordTakenToHouseBy           Employee? @relation("RecordTakenToHouseBy", fields: [recordTakenEmpId], references: [id])

  appointmentCompletedByEmpId    String?   @db.VarChar(40)
  appointmentCompletedBy         Employee? @relation("AppointmentCompletedBy", fields: [appointmentCompletedByEmpId], references: [id])

  recordFiledDate                DateTime? @db.Date
  recordFiledEmpId               String?   @db.VarChar(40)
  recordFiledBy                  Employee? @relation("RecordFiledBy", fields: [recordFiledEmpId], references: [id])

  doctor                         String    @db.VarChar(60)
  doctorType                     String    @db.VarChar(30)
  appointmentForCondition        String    @db.VarChar(50)
  appointmentResults             String?   @db.Text

  event                          Event     @relation(fields: [id], references: [id])
}




model House {
  id String @id @db.VarChar(20)
  name String @unique @db.VarChar(25)
  street1 String @db.VarChar(50)
  street2 String? @db.VarChar(25)
  city String @db.VarChar(30)
  state String @db.VarChar(25)
  maxClients Int @db.Integer
  femaleEmployeeOnly Boolean
  clients Client[]
  primaryHouseManager Employee? @relation("PrimaryManager", fields: [primaryManagerId], references: id)
  secondaryHouseManager Employee? @relation("SecondaryManager", fields: [secondaryManagerId], references: id)
  primaryManagerId String? @db.VarChar(40)
  secondaryManagerId String? @db.VarChar(40)
}

model RefreshToken {
  id           String   @id @default(cuid())
  token        String   @unique
  employeeId   String
  employee     Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  createdAt    DateTime @default(now())
  expiresAt    DateTime
  revoked      Boolean  @default(false)
  revokedAt    DateTime?
  replacedById String?  @unique
  replacedBy   RefreshToken? @relation("TokenReplacement", fields: [replacedById], references: [id])

  replaces       RefreshToken?  @relation("TokenReplacement")

  @@index([expiresAt])
}

model Session {
  id          String   @id @default(uuid())
  token        String   @unique
  employeeId  String @db.VarChar(40)
  employee    Employee @relation(fields: [employeeId], references: [id])
  isValid     Boolean  @default(true)
  expiresAt   DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}